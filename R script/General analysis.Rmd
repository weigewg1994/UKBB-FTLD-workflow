---
title: "R Notebook"
output: html_notebook
---

Libraries
```{r}
library(readxl)
library(readr)
library(MatchIt)
library(dplyr)
```

Import data
```{r}
Participant_table_with_related_disorders <- read_excel("C:/Users/Charlie Zhao/OneDrive - Mass General Brigham/Research/UK Biobank/Data/Participant_table with related disorders.xlsx")
PSP_w_exposures <- read_csv("C:/Users/Charlie Zhao/OneDrive - Mass General Brigham/Research/UK Biobank/Data/PSP_w_exposures.csv")
PSP_assessment_centre <- read_csv("C:/Users/Charlie Zhao/OneDrive - Mass General Brigham/Research/UK Biobank/Data/PSP_assessment_centre.csv")
Control_w_exposures <- read_csv("C:/Users/Charlie Zhao/OneDrive - Mass General Brigham/Research/UK Biobank/Data/Control_w_exposures.csv")
Controls_age_and_sex <- read_csv("C:/Users/Charlie Zhao/OneDrive - Mass General Brigham/Research/UK Biobank/Data/Controls_age_and_sex.csv")

```

Combine groups into PSP and healthy cohorts, then combine into single dataframe

```{r}
Controls_all <- merge(Control_w_exposures,
                      Controls_age_and_sex,
                      by = "Participant ID")
PSP_all <- merge(PSP_w_exposures,
                 Participant_table_with_related_disorders,
                 by = "Participant ID")
PSP_all <- merge(PSP_all,
                 PSP_assessment_centre,
                 by = "Participant ID")
if ("UK Biobank assessment centre | Instance 0.y" %in% names(PSP_all)) { #Fix name discrepancy
  PSP_all <- PSP_all %>%
    rename(`UK Biobank assessment centre | Instance 0` =
             `UK Biobank assessment centre | Instance 0.y`)
}
```

Combine into one dataframe
```{r}
psp  <- PSP_all %>% mutate(case = 1L)
ctrl <- Controls_all %>% mutate(case = 0L)
df <- bind_rows(psp,ctrl)
```

Make matched control group, matched on age, sex, and assessment center, at 10:1 ratio
```{r}
m <- matchit(
  case ~ `Sex` + `Age at recruitment` + `UK Biobank assessment centre | Instance 0`,
  data = df,
  method = "nearest",
  distance = "glm",
  ratio = 10
)

summary(m)

matched_ctrl <- match.data(m)
```


Analysis
```{r}


```



